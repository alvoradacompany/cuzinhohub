local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")

local playertoggle = false
local pctoggle = false
local podstoggle = false
local exitstoggle = false
local doortoggle = false
local neverfailtoggle = false
local noclipEnabled = false

-- Remove GUIs antigas
if LocalPlayer:FindFirstChild("PlayerGui") then
	for _, gui in pairs(LocalPlayer.PlayerGui:GetChildren()) do
		if gui:IsA("ScreenGui") then
			gui:Destroy()
		end
	end
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame")
Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(0,0,0)
Frame.Size = UDim2.new(0,300,0,420)
Frame.Position = UDim2.new(0.35,0,0.3,0)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true

local TextLabel = Instance.new("TextLabel")
TextLabel.Parent = Frame
TextLabel.Size = UDim2.new(1,0,0,30)
TextLabel.BackgroundColor3 = Color3.fromRGB(0,0,0)
TextLabel.BorderSizePixel = 0
TextLabel.Text = "Cuzinho Hub"
TextLabel.TextColor3 = Color3.fromRGB(0,13,255)
TextLabel.TextScaled = true

-- Função para criar botão com toggle de cor
local function createToggleButton(name,text,posY,callback)
	local b = Instance.new("TextButton")
	b.Name = name
	b.Parent = Frame
	b.Size = UDim2.new(1,0,0,30)
	b.Position = UDim2.new(0,0,posY,0)
	b.BackgroundColor3 = Color3.fromRGB(38,38,38) -- cinza desligado
	b.TextColor3 = Color3.fromRGB(255,255,255)
	b.TextScaled = true
	b.Text = text

	-- estado interno
	local active = false

	b.MouseButton1Click:Connect(function()
		active = not active
		if active then
			b.BackgroundColor3 = Color3.fromRGB(0,170,0) -- verde ativado
		else
			b.BackgroundColor3 = Color3.fromRGB(38,38,38) -- cinza desligado
		end
		if callback then
			callback(active)
		end
	end)
	return b
end

-- Highlight helper
local function ensureHighlight(parent)
	if parent and not parent:FindFirstChild("Highlight") then
		local h = Instance.new("Highlight")
		h.Parent = parent
		h.Adornee = parent
		h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
		h.FillTransparency = 1
		return h
	end
	return parent and parent:FindFirstChild("Highlight") or nil
end

-- Funções ESP
local function getBeast()
	for _, player in pairs(Players:GetPlayers()) do
		if player.Character and player.Character:FindFirstChild("Hammer") then
			return player
		end
	end
	return nil
end

local function updatePlayerESP()
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character then
			local char = player.Character
			if playertoggle then
				local h = ensureHighlight(char)
				if h then
					spawn(function()
						repeat
							wait(0.12)
							if player == getBeast() then
								h.OutlineColor = Color3.fromRGB(170,0,0)
							else
								h.OutlineColor = Color3.fromRGB(0,170,0)
							end
						until not playertoggle or not char.Parent or not h.Parent
					end)
				end
			else
				if char:FindFirstChild("Highlight") then
					char.Highlight:Destroy()
				end
			end
		end
	end
end

local function updatePCESP()
	if ReplicatedStorage:FindFirstChild("CurrentMap") and ReplicatedStorage.CurrentMap.Value then
		local map = ReplicatedStorage.CurrentMap.Value
		for _, obj in pairs(map:GetChildren()) do
			if obj.Name == "ComputerTable" then
				if pctoggle then
					local h = ensureHighlight(obj)
					if h then
						spawn(function()
							repeat
								wait(1)
								if obj:FindFirstChild("Screen") then
									local c = obj.Screen.Color
									local r,g,b = c.R, c.G, c.B
									if r >= g and r >= b then
										h.OutlineColor = Color3.fromRGB(130,0,0)
									elseif g >= r and g >= b then
										h.OutlineColor = Color3.fromRGB(0,130,0)
									else
										h.OutlineColor = Color3.fromRGB(0,0,130)
									end
								end
							until not pctoggle or not obj.Parent or not h.Parent
						end)
					end
				else
					if obj:FindFirstChild("Highlight") then
						obj.Highlight:Destroy()
					end
				end
			end
		end
	end
end

local function updateFreezePodESP()
	for _, v in pairs(Workspace:GetDescendants()) do
		if v.Name == "FreezePod" then
			if podstoggle then
				if not v:FindFirstChild("Highlight") then
					local h = Instance.new("Highlight", v)
					h.Adornee = v
					h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
					h.FillTransparency = 1
					h.OutlineColor = Color3.fromRGB(0,170,220)
				end
			else
				if v:FindFirstChild("Highlight") then
					v.Highlight:Destroy()
				end
			end
		end
	end
end

local function updateExitDoorESP()
	for _, v in pairs(Workspace:GetDescendants()) do
		if v.Name == "ExitDoor" then
			if exitstoggle then
				if not v:FindFirstChild("Highlight") then
					local h = Instance.new("Highlight", v)
					h.Adornee = v
					h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
					h.FillTransparency = 1
					h.OutlineColor = Color3.fromRGB(180,180,0)
				end
			else
				if v:FindFirstChild("Highlight") then
					v.Highlight:Destroy()
				end
			end
		end
	end
end

-- Door ESP
local doorLoopRunning = false
local function startDoorESP()
	if doorLoopRunning then return end
	doorLoopRunning = true
	spawn(function()
		repeat
			wait(0.5)
			for _, door in pairs(Workspace:GetDescendants()) do
				if door.Name == "SingleDoor" or door.Name == "DoubleDoor" then
					if doortoggle then
						if not door:FindFirstChild("Highlight") then
							local highlight = Instance.new("Highlight")
							highlight.Parent = door
							highlight.Adornee = door
							highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
							highlight.FillTransparency = 0.5
							highlight.OutlineTransparency = 0
							highlight.OutlineColor = Color3.fromRGB(180, 180, 180)
						end
						local hl = door:FindFirstChild("Highlight")
						if hl and door:FindFirstChild("DoorTrigger") and door.DoorTrigger:FindFirstChild("ActionSign") then
							local val = door.DoorTrigger.ActionSign.Value
							if val == 11 then
								hl.FillColor = Color3.fromRGB(0, 180, 0)
							elseif val == 10 then
								hl.FillColor = Color3.fromRGB(180, 0, 0)
							end
						end
					else
						if door:FindFirstChild("Highlight") then
							door.Highlight:Destroy()
						end
					end
				end
			end
		until not doortoggle
		for _, door in pairs(Workspace:GetDescendants()) do
			if door.Name == "SingleDoor" or door.Name == "DoubleDoor" then
				if door:FindFirstChild("Highlight") then
					door.Highlight:Destroy()
				end
			end
		end
		doorLoopRunning = false
	end)
end

-- Criação dos botões com toggle de cor
local espPlayersBtn = createToggleButton("espPlayers","ESP Players",0.07,function(state)
	playertoggle = state
	updatePlayerESP()
end)

local espPCsBtn = createToggleButton("espPCs","ESP PCs",0.17,function(state)
	pctoggle = state
	updatePCESP()
end)

local freezePodsBtn = createToggleButton("freezePods","FreezePod ESP",0.27,function(state
