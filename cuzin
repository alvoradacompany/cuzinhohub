local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")

local playertoggle = false
local pctoggle = false
local podstoggle = false
local exitstoggle = false
local doortoggle = false
local neverfailtoggle = false

if LocalPlayer:FindFirstChild("PlayerGui") then
	for _, gui in pairs(LocalPlayer.PlayerGui:GetChildren()) do
		if gui.Name == "ScreenGui" then
			gui:Destroy()
		end
	end
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame")
Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(0,0,0)
Frame.Size = UDim2.new(0,300,0,340)
Frame.Position = UDim2.new(0.35,0,0.3,0)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true

local TextLabel = Instance.new("TextLabel")
TextLabel.Parent = Frame
TextLabel.Size = UDim2.new(1,0,0,30)
TextLabel.BackgroundColor3 = Color3.fromRGB(0,0,0)
TextLabel.BorderSizePixel = 0
TextLabel.Text = "Cuzinho Hub"
TextLabel.TextColor3 = Color3.fromRGB(0,13,255)
TextLabel.TextScaled = true

local function createButton(name,text,posY)
	local b = Instance.new("TextButton")
	b.Name = name
	b.Parent = Frame
	b.Size = UDim2.new(1,0,0,30)
	b.Position = UDim2.new(0,0,posY,0)
	b.BackgroundColor3 = Color3.fromRGB(38,38,38)
	b.TextColor3 = Color3.fromRGB(255,255,255)
	b.TextScaled = true
	b.Text = text
	return b
end

local espPlayersBtn = createButton("espPlayers","ESP Players",0.12)
local espPCsBtn = createButton("espPCs","ESP PCs",0.25)
local freezePodsBtn = createButton("freezePods","FreezePod ESP",0.38)
local exitDoorsBtn = createButton("exitDoors","ExitDoor ESP",0.51)
local doorBtn = createButton("doorESP","Door ESP",0.64)
local tpPCBtn = createButton("tpPCBtn","TP PC Próximo",0.77)
local speedBtn = createButton("speedBtn","Speed Toggle",0.9)
local noclipBtn = createButton("noclipBtn","Noclip Toggle",1.03)
local neverFailBtn = createButton("neverFail","Never Fail Hacking",1.16)
local shadowsOnBtn = createButton("shadowsOn","Ativar Sombras",1.29)
local shadowsOffBtn = createButton("shadowsOff","Desativar Sombras",1.42)

local toggleBtn = Instance.new("TextButton")
toggleBtn.Parent = ScreenGui
toggleBtn.Size = UDim2.new(0,50,0,50)
toggleBtn.Position = UDim2.new(1,-60,0,10)
toggleBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.Text = "☰"
toggleBtn.TextScaled = true
toggleBtn.BorderSizePixel = 0
toggleBtn.AutoButtonColor = true
toggleBtn.Style = Enum.ButtonStyle.RobloxRoundDefaultButton
toggleBtn.MouseButton1Click:Connect(function()
	Frame.Visible = not Frame.Visible
end)

local function getBeast()
	for _, player in pairs(Players:GetPlayers()) do
		if player.Character and player.Character:FindFirstChild("Hammer") then
			return player
		end
	end
	return nil
end

local function ensureHighlight(parent)
	if parent and not parent:FindFirstChild("Highlight") then
		local h = Instance.new("Highlight")
		h.Parent = parent
		h.Adornee = parent
		h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
		h.FillTransparency = 1
		return h
	end
	return parent and parent:FindFirstChild("Highlight") or nil
end

local function updatePlayerESP()
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character then
			local char = player.Character
			if playertoggle then
				local h = ensureHighlight(char)
				if h then
					spawn(function()
						repeat
							wait(0.12)
							if player == getBeast() then
								h.OutlineColor = Color3.fromRGB(170,0,0)
							else
								h.OutlineColor = Color3.fromRGB(0,170,0)
							end
						until not playertoggle or not char.Parent or not h.Parent
					end)
				end
			else
				if char:FindFirstChild("Highlight") then
					char.Highlight:Destroy()
				end
			end
		end
	end
end

local function updatePCESP()
	if ReplicatedStorage:FindFirstChild("CurrentMap") and ReplicatedStorage.CurrentMap.Value then
		local map = ReplicatedStorage.CurrentMap.Value
		for _, obj in pairs(map:GetChildren()) do
			if obj.Name == "ComputerTable" then
				if pctoggle then
					local h = ensureHighlight(obj)
					if h then
						spawn(function()
							repeat
								wait(1)
								if obj:FindFirstChild("Screen") then
									local c = obj.Screen.Color
									local r,g,b = c.R, c.G, c.B
									if r >= g and r >= b then
										h.OutlineColor = Color3.fromRGB(130,0,0)
									elseif g >= r and g >= b then
										h.OutlineColor = Color3.fromRGB(0,130,0)
									else
										h.OutlineColor = Color3.fromRGB(0,0,130)
									end
								end
							until not pctoggle or not obj.Parent or not h.Parent
						end)
					end
				else
					if obj:FindFirstChild("Highlight") then
						obj.Highlight:Destroy()
					end
				end
			end
		end
	end
end

local function updateFreezePodESP()
	for _, v in pairs(Workspace:GetDescendants()) do
		if v.Name == "FreezePod" then
			if podstoggle then
				if not v:FindFirstChild("Highlight") then
					local h = Instance.new("Highlight", v)
					h.Adornee = v
					h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
					h.FillTransparency = 1
					h.OutlineColor = Color3.fromRGB(0,170,220)
				end
			else
				if v:FindFirstChild("Highlight") then
					v.Highlight:Destroy()
				end
			end
		end
	end
end

local function updateExitDoorESP()
	for _, v in pairs(Workspace:GetDescendants()) do
		if v.Name == "ExitDoor" then
			if exitstoggle then
				if not v:FindFirstChild("Highlight") then
					local h = Instance.new("Highlight", v)
					h.Adornee = v
					h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
					h.FillTransparency = 1
					h.OutlineColor = Color3.fromRGB(180,180,0)
				end
			else
				if v:FindFirstChild("Highlight") then
					v.Highlight:Destroy()
				end
			end
		end
	end
end

local doorLoopRunning = false
local function startDoorESP()
	if doorLoopRunning then return end
	doorLoopRunning = true
	spawn(function()
		repeat
			wait(0.5)
			for _, door in pairs(Workspace:GetDescendants()) do
				if door.Name == "SingleDoor" or door.Name == "DoubleDoor" then
					if doortoggle then
						if not door:FindFirstChild("Highlight") then
							local highlight = Instance.new("Highlight")
							highlight.Parent = door
							highlight.Adornee = door
							highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
							highlight.FillTransparency = 0.5
							highlight.OutlineTransparency = 0
							highlight.OutlineColor = Color3.fromRGB(180, 180, 180)
						end
						local hl = door:FindFirstChild("Highlight")
						if hl and door:FindFirstChild("DoorTrigger") and door.DoorTrigger:FindFirstChild("ActionSign") then
							local val = door.DoorTrigger.ActionSign.Value
							if val == 11 then
								hl.FillColor = Color3.fromRGB(0, 180, 0)
							elseif val == 10 then
								hl.FillColor = Color3.fromRGB(180, 0, 0)
							end
						end
					else
						if door:FindFirstChild("Highlight") then
							door.Highlight:Destroy()
						end
					end
				end
			end
		until not doortoggle
		for _, door in pairs(Workspace:GetDescendants()) do
			if door.Name == "SingleDoor" or door.Name == "DoubleDoor" then
				if door:FindFirstChild("Highlight") then
					door.Highlight:Destroy()
				end
			end
		end
		doorLoopRunning = false
	end)
end

espPlayersBtn.MouseButton1Click:Connect(function()
	playertoggle = not playertoggle
	updatePlayerESP()
end)

espPCsBtn.MouseButton1Click:Connect(function()
	pctoggle = not pctoggle
	updatePCESP()
end)

freezePodsBtn.MouseButton1Click:Connect(function()
	podstoggle = not podstoggle
	updateFreezePodESP()
end)

exitDoorsBtn.MouseButton1Click:Connect(function()
	exitstoggle = not exitstoggle
	updateExitDoorESP()
end)

doorBtn.MouseButton1Click:Connect(function()
	doortoggle = not doortoggle
	if doortoggle then
		startDoorESP()
	else
		-- removal handled in loop
	end
end)

tpPCBtn.MouseButton1Click:Connect(function()
	local closestPC
	local shortestDist = math.huge
	if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
		for _, obj in pairs(Workspace:GetDescendants()) do
			if obj.Name == "ComputerTable" then
				local primary = obj:FindFirstChild("PrimaryPart") or obj:FindFirstChildWhichIsA("BasePart")
				if primary then
					local dist = (LocalPlayer.Character.HumanoidRootPart.Position - primary.Position).Magnitude
					if dist < shortestDist then
						shortestDist = dist
						closestPC = primary
					end
				end
			end
		end
		if closestPC then
			LocalPlayer.Character:SetPrimaryPartCFrame(CFrame.new(closestPC.Position + Vector3.new(0,3,0)))
		end
	end
end)

speedBtn.MouseButton1Click:Connect(function()
	if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
		local humanoid = LocalPlayer.Character.Humanoid
		if humanoid.WalkSpeed == 16 then
			humanoid.WalkSpeed = 50
		else
			humanoid.WalkSpeed = 16
		end
	end
end)

local noclipEnabled = false
noclipBtn.MouseButton1Click:Connect(function()
	noclipEnabled = not noclipEnabled
	spawn(function()
		while noclipEnabled do
			wait(0.1)
			if LocalPlayer.Character then
				for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
					if part:IsA("BasePart") then
						part.CanCollide = false
					end
				end
			end
		end
	end)
end)

local oldNamecall = nil
local mt = nil
neverFailBtn.MouseButton1Click:Connect(function()
	neverfailtoggle = not neverfailtoggle
	if neverfailtoggle then
		mt = getrawmetatable(game)
		oldNamecall = mt.__namecall
		setreadonly(mt, false)
		mt.__namecall = newcclosure(function(self, ...)
			local args = {...}
			if getnamecallmethod() == 'FireServer' and args[1] == 'SetPlayerMinigameResult' and neverfailtoggle then
				args[2] = true
			end
			return oldNamecall(self, unpack(args))
		end)
		setreadonly(mt, true)
	else
		if mt and oldNamecall then
			setreadonly(mt, false)
			mt.__namecall = oldNamecall
			setreadonly(mt, true)
		end
		neverfailtoggle = false
	end
end)

shadowsOnBtn.MouseButton1Click:Connect(function()
	Lighting.GlobalShadows = true
end)

shadowsOffBtn.MouseButton1Click:Connect(function()
	Lighting.GlobalShadows = false
end)

spawn(function()
	while true do
		wait(1)
		if playertoggle then updatePlayerESP() end
		if pctoggle then updatePCESP() end
		if podstoggle then updateFreezePodESP() end
		if exitstoggle then updateExitDoorESP() end
	end
end)
